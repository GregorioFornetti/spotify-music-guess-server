import"./modulepreload-polyfill-3cfb730f.js";import{a as l,U as p}from"./addLoading-82809337.js";import{l as f}from"./configs-48bf7a92.js";const h=window.location.href.replace("?","");async function u(e){const a=g(128),r=await y(a);localStorage.setItem("verifier",a);const t=window.location.href.replace("?",""),o=new URLSearchParams;o.append("client_id",e),o.append("response_type","code"),o.append("redirect_uri",t),o.append("scope","user-read-private user-read-email user-modify-playback-state user-read-playback-state playlist-read-private playlist-read-collaborative user-library-read"),o.append("code_challenge_method","S256"),o.append("code_challenge",r),document.location=`https://accounts.spotify.com/authorize?${o.toString()}`}async function m(e,a){if(localStorage.getItem("acess_token")){const r=localStorage.getItem("refresh_token"),t=new URLSearchParams;t.append("client_id",e),t.append("grant_type","refresh_token"),t.append("refresh_token",r);const o=await fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:t}),{access_token:n,refresh_token:s}=await o.json();return n&&localStorage.setItem("acess_token",n),s&&localStorage.setItem("refresh_token",s),n}else{const r=localStorage.getItem("verifier"),t=new URLSearchParams;t.append("client_id",e),t.append("grant_type","authorization_code"),t.append("code",a),t.append("redirect_uri",h),t.append("code_verifier",r);const o=await fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:t});alert(o.status),alert(o.statusText);const{access_token:n,refresh_token:s}=await o.json();return n&&localStorage.setItem("acess_token",n),s&&localStorage.setItem("refresh_token",s),n}}function g(e){let a="",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let t=0;t<e;t++)a+=r.charAt(Math.floor(Math.random()*r.length));return a}async function y(e){const a=new TextEncoder().encode(e),r=await window.crypto.subtle.digest("SHA-256",a);return btoa(String.fromCharCode.apply(null,[...new Uint8Array(r)])).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function w(){return(await fetch("https://api.spotify.com/v1/me",{method:"GET",headers:p.accessTokenHeader}).then(a=>a.json())).country}async function _(e){return l(w,e)}const d="b3c2339a149d46afa94a39347466b623",c=new URLSearchParams(window.location.search),i=c.get("code");document.addEventListener("DOMContentLoaded",async()=>{if(i)try{alert(i);const e=await m(d,i);console.log(e),p.accessToken=e;const a=await _();c.delete("code"),c.append("login","true"),c.append("acessToken",e),c.append("country",a),document.location=`${f}?${c.toString()}`}catch(e){console.log("Não foi possível carregar o home page",e)}else u(d)});
