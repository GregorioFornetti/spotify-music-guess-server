import"./modulepreload-polyfill-3cfb730f.js";import{a as f,U as p}from"./addLoading-82809337.js";import{l as h}from"./configs-48bf7a92.js";const i=window.location.href.replace("?","");async function u(e){const o=g(128),r=await y(o);localStorage.setItem("verifier",o);const t=window.location.href.replace("?",""),a=new URLSearchParams;a.append("client_id",e),a.append("response_type","code"),a.append("redirect_uri",t),a.append("scope","user-read-private user-read-email user-modify-playback-state user-read-playback-state playlist-read-private playlist-read-collaborative user-library-read"),a.append("code_challenge_method","S256"),a.append("code_challenge",r),document.location=`https://accounts.spotify.com/authorize?${a.toString()}`}async function m(e,o){if(localStorage.getItem("acess_token")){const r=localStorage.getItem("refresh_token"),t=new URLSearchParams;t.append("client_id",e),t.append("grant_type","refresh_token"),t.append("refresh_token",r);const a=await fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:t}),{access_token:n,refresh_token:s}=await a.json();return n&&localStorage.setItem("acess_token",n),s&&localStorage.setItem("refresh_token",s),n}else{const r=localStorage.getItem("verifier"),t=new URLSearchParams;t.append("client_id",e),t.append("grant_type","authorization_code"),t.append("code",o),alert(`REDURECT URI ${i}`),alert(i),t.append("redirect_uri",i),t.append("code_verifier",r);const a=await fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:t});alert(a.status),alert(a.statusText),alert(await a.text());const{access_token:n,refresh_token:s}=await a.json();return alert(n),n&&localStorage.setItem("acess_token",n),s&&localStorage.setItem("refresh_token",s),n}}function g(e){let o="",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let t=0;t<e;t++)o+=r.charAt(Math.floor(Math.random()*r.length));return o}async function y(e){const o=new TextEncoder().encode(e),r=await window.crypto.subtle.digest("SHA-256",o);return btoa(String.fromCharCode.apply(null,[...new Uint8Array(r)])).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function w(){return(await fetch("https://api.spotify.com/v1/me",{method:"GET",headers:p.accessTokenHeader}).then(o=>o.json())).country}async function _(e){return f(w,e)}const d="b3c2339a149d46afa94a39347466b623",c=new URLSearchParams(window.location.search),l=c.get("code");document.addEventListener("DOMContentLoaded",async()=>{if(l)try{const e=await m(d,l);console.log(e),p.accessToken=e;const o=await _();c.delete("code"),c.append("login","true"),c.append("acessToken",e),c.append("country",o),document.location=`${h}?${c.toString()}`}catch(e){console.log("Não foi possível carregar o home page",e)}else u(d)});
