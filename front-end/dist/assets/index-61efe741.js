import{a as h,U as l}from"./addLoading-d4a3ae7d.js";const i="https://gregoriofornetti.github.io/spotify-music-guess/dist";async function u(o){const a=f(128),t=await g(a);localStorage.setItem("verifier",a);const e=new URLSearchParams;e.append("client_id",o),e.append("response_type","code"),e.append("redirect_uri",i),e.append("scope","user-read-private user-read-email user-modify-playback-state user-read-playback-state playlist-read-private playlist-read-collaborative user-library-read"),e.append("code_challenge_method","S256"),e.append("code_challenge",t),document.location=`https://accounts.spotify.com/authorize?${e.toString()}`}async function m(o,a){if(localStorage.getItem("acess_token")){const t=localStorage.getItem("refresh_token"),e=new URLSearchParams;e.append("client_id",o),e.append("grant_type","refresh_token"),e.append("refresh_token",t);const s=await fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:e}),{access_token:r,refresh_token:c}=await s.json();return r&&localStorage.setItem("acess_token",r),c&&localStorage.setItem("refresh_token",c),r}else{const t=localStorage.getItem("verifier"),e=new URLSearchParams;e.append("client_id",o),e.append("grant_type","authorization_code"),e.append("code",a),e.append("redirect_uri",i),e.append("code_verifier",t);const s=await fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:e}),{access_token:r,refresh_token:c}=await s.json();return r&&localStorage.setItem("acess_token",r),c&&localStorage.setItem("refresh_token",c),r}}function f(o){let a="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let e=0;e<o;e++)a+=t.charAt(Math.floor(Math.random()*t.length));return a}async function g(o){const a=new TextEncoder().encode(o),t=await window.crypto.subtle.digest("SHA-256",a);return btoa(String.fromCharCode.apply(null,[...new Uint8Array(t)])).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function y(){return(await fetch("https://api.spotify.com/v1/me",{method:"GET",headers:l.accessTokenHeader}).then(a=>a.json())).country}async function w(o){return h(y,o)}const d="b3c2339a149d46afa94a39347466b623",n=new URLSearchParams(window.location.search),p=n.get("code");document.addEventListener("DOMContentLoaded",async()=>{if(p)try{const t=await m(d,p);l.accessToken=t;const e=await w();n.delete("code"),n.append("login","true"),n.append("acessToken",t),n.append("country",e),document.location=`${i}/home.html?${n.toString()}`}catch(t){console.log("Não foi possível carregar o home page",t)}const o=document.getElementById("login");o==null||o.addEventListener("click",()=>{u(d)});const a=document.getElementById("no-login");a==null||a.addEventListener("click",async()=>{const t=await fetch("/auth-without-login").then(e=>e.text());n.append("login","false"),n.append("acessToken",t),n.append("country","br"),document.location=`home.html?${n.toString()}`})});
